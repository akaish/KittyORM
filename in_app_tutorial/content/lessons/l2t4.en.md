---
title: "Lesson2 Tab 4: find entity"
date: 2018-11-15T06:50:21+03:00
draft: false
layout: "lesson"
---
### Finding entities with KittyORM
To find entities with KittyORM just use one of methods already implemented at `KittyMapper.class`:
{{< highlight java "linenos=inline, linenostart=1">}}
// Initializing database instance
BasicDatabase db = new BasicDatabase(getContext());
// Getting mapper instance
RandomMapper mapper = (RandomMapper) db.getMapper(RandomModel.class);
// Getting existing model from database (assuming that 0l model exists)
RandomModel byIPK = mapper.findByIPK(0l);
// Getting existing model with rowid (assuming that 10l model exists)
RandomModel byRowid = mapper.findByRowID(10l);
// Getting all models
List<RandomModel> all = mapper.findAll();
// Getting model with condition (fetching 100 existing tigers)
QueryParameters parameters = new QueryParameters();
parameters.setOffset(0l).setLimit(100l);
SQLiteConditionBuilder builder = new SQLiteConditionBuilder();
builder.addField(AbstractRandomModel.RND_ANIMAL_CNAME)
       .addSQLOperator(SQLiteOperator.EQUAL)
       .addValue(Animals.TIGER.name());
List<RandomModel> hundredOfTigers = mapper.findWhere(builder.build(), parameters);
{{< /highlight >}}

<details> 
  <summary>Click to view all already implemented find methods: </summary>

Method name | Method description
--- | --- 
`findWhere(SQLiteCondition where, QueryParameters qParams)` | Returns list of models associated with records in backed database table that suits provided clause and query parameters.
`findWhere(SQLiteCondition where)` | Returns list of models associated with records in backed database table that suits provided clause.
`findAll(QueryParameters qParams)`  | Returns list of all models associated with records in backed database table with usage of passed qParams.
`findAll()` | Returns list of all models associated with records in backed database table.
`findByRowID(Long rowid)` | Returns model filled with data from database or null if no record with provided rowid found.
`findByPK(KittyPrimaryKey primaryKey)` | Returns model filled with data from database or null if no record with provided PK found.
`findByIPK(Long ipk)` | Returns model filled with data from database or null if no record with provided IPK found.
`findFirst(SQLiteCondition where)` | Returns first record in KittyModel wrapper in database table that suits provided condition.
`findFirst()` | Returns first record in KittyModel wrapper in database table.
`findLast(SQLiteCondition where)` | Returns last record in KittyModel wrapper in database table that suits provided condition.
`findLast()` | Returns last record in KittyModel wrapper in database table.

</details>

> Do not count collection received from `findAll()` method if you want to count all records in table, use already implemented **sum** and **count** methods!

See following count and sum code example snippet:
{{< highlight java "linenos=inline, linenostart=1">}}
// Initializing database instance
BasicDatabase db = new BasicDatabase(getContext());
// Getting mapper instance
RandomMapper mapper = (RandomMapper) db.getMapper(RandomModel.class);
// Count all records in database
long count = mapper.countAll();
// Count all dogs
SQLiteConditionBuilder builder = new SQLiteConditionBuilder();
builder.addField(AbstractRandomModel.RND_ANIMAL_CNAME)
       .addSQLOperator(SQLiteOperator.EQUAL)
       .addValue(Animals.DOG.name());
long dogsCount = mapper.countWhere(builder.build());
// Sum all dog's random_int
long dogsRndIntSum = mapper.sum("random_int", builder.build());
{{< /highlight >}}

### Implementing extended CRUD controller
OK, this is simple, already implemented by `KittyMapper` methods allows you to do most of the database related operations, however you may want to extend `KittyMapper` CRUD controller and implement some methods that would be used commonly in your application. Here some steps to take:

1. Define in KittyORM registry CRUD controller to be used with particular model by defining it in your `KittyDatabase` implementation class with usage `@KITTY_DATABASE_REGISTRY` at `domainPairs` or by defining it at your model implementation class with usage of `@KITTY_EXTENDED_CRUD` annotation:
{{< highlight java "linenos=inline, linenostart=1">}}
// Defining at registry example
@KITTY_DATABASE(
        databaseName = "basic_database",
        domainPackageNames = {"net.akaish.kittyormdemo.sqlite.basicdb"},
        ...
)
@KITTY_DATABASE_REGISTRY(
        domainPairs = {
                @KITTY_REGISTRY_PAIR(model = ComplexRandomModel.class, mapper = ComplexRandomMapper.class),
                @KITTY_REGISTRY_PAIR(model = IndexesAndConstraintsModel.class),
                @KITTY_REGISTRY_PAIR(model = RandomModel.class, mapper = RandomMapper.class) // registry CRUD controller definition
        }
)
public class BasicDatabase extends KittyDatabase {
    ...
}
// Defining at model example
@KITTY_TABLE
@KITTY_EXTENDED_CRUD(extendedCrudController = RandomMapper.class) // model CRUD controller definition
@INDEX(
        indexName = "random_animal_index",
        indexColumns = {AbstractRandomModel.RND_ANIMAL_CNAME}
)
public class RandomModel extends AbstractRandomModel {
    ...
}
{{< /highlight >}}

2. Create new class that extends `KittyMapper.class`, implement default constructor and locate it at domain package, fill it with your logic.
<details> 
  <summary>Click to view extended crud controller implementation example: </summary>
{{< highlight java "linenos=inline, linenostart=1">}}
public class RandomMapper extends KittyMapper {

    public <M extends KittyModel> RandomMapper(KittyTableConfiguration tableConfiguration,
                                              M blankModelInstance,
                                              String databasePassword) {
        super(tableConfiguration, blankModelInstance, databasePassword);
    }

    protected SQLiteCondition getAnimalCondition(Animals animal) {
        return new SQLiteConditionBuilder()
                .addField(RND_ANIMAL_CNAME)
                .addSQLOperator(SQLiteOperator.EQUAL)
                .addObjectValue(animal)
                .build();
    }

    public long deleteByRandomIntegerRange(int start, int end) {
        SQLiteCondition condition = new SQLiteConditionBuilder()
                .addField("random_int")
                .addSQLOperator(GREATER_OR_EQUAL)
                .addValue(start)
                .addSQLOperator(AND)
                .addField("random_int")
                .addSQLOperator(LESS_OR_EQUAL)
                .addValue(end)
                .build();
        return deleteByWhere(condition);
    }

    public long deleteByAnimal(Animals animal) {
        return deleteByWhere(getAnimalCondition(animal));
    }

    public List<RandomModel> findByAnimal(Animals animal, long offset, long limit, boolean groupingOn) {
        SQLiteCondition condition = getAnimalCondition(animal);
        QueryParameters qparam = new QueryParameters();
        qparam.setLimit(limit).setOffset(offset);
        if(groupingOn)
            qparam.setGroupByColumns(RND_ANIMAL_CNAME);
        else
            qparam.setGroupByColumns(KittyConstants.ROWID);
        return findWhere(condition, qparam);
    }

    public List<RandomModel> findByIdRange(long fromId, long toId, boolean inclusive, Long offset, Long limit) {
        SQLiteCondition condition = new SQLiteConditionBuilder()
                .addField("id")
                .addSQLOperator(inclusive ? GREATER_OR_EQUAL : GREATER_THAN)
                .addValue(fromId)
                .addSQLOperator(AND)
                .addField("id")
                .addSQLOperator(inclusive ? LESS_OR_EQUAL : LESS_THAN)
                .addValue(toId)
                .build();
        QueryParameters qparam = new QueryParameters();
        qparam.setLimit(limit).setOffset(offset).setGroupByColumns(KittyConstants.ROWID);
        return findWhere(condition, qparam);
    }

    public List<RandomModel> findAllRandomModels(Long offset, Long limit) {
        QueryParameters qparam = new QueryParameters();
        qparam.setLimit(limit).setOffset(offset).setGroupByColumns(KittyConstants.ROWID);
        return findAll(qparam);
    }

}
{{< /highlight >}} 

</details>

That's all, after this when you call `getMapper(Class modelClass)` of your `KittyDatabase` implementation you would receive ready to go your extended CRUD controller.

This page is a part of KittyORM project (KittyORM Documentation) and licensed under a Creative Commons Attribution-ShareAlike 4.0 International License. To view a copy of this license, visit http://creativecommons.org/licenses/by-sa/4.0/ or send a letter to Creative Commons, PO Box 1866, Mountain View, CA 94042, US., more information at https://akaish.github.io/KittyORMPages/license/
